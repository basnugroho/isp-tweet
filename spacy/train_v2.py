import spacy
import random

TRAIN_DATA = [('Tes indihome longlat', {'entities': [[4, 12, 'ISP']]}), ('Biaya Pasang Baru Indihome Diskon 50%', {'entities': [[18, 26, 'ISP']]}), ('Yukk buruan pasang indihome nya sekarang juga (ppn11%)', {'entities': [[19, 27, 'ISP']]}), ('Di bulan berikutnya bayar sesuai harga paket yg di pilih ', {'entities': [[3, 19, 'TIME']]}), ('081295078025 ( Herryboy) https://t.co/lxSXNlqfIA', {'entities': [[15, 23, 'PERSON']]}), ('Telkomsel tes get area 3', {'entities': [[0, 9, 'ISP'], [18, 24, 'PLACE']]}), ('langsung aja buka grab', {'entities': [[18, 22, 'DIGITAL SERVICE']]}), ('internetnya pakai indihome pastinya', {'entities': [[0, 11, 'DIGITAL SERVICE'], [18, 26, 'ISP']]}), ('hujan malam hari paling enak', {'entities': [[6, 16, 'TIME']]}), ('pakai indihome koneksi wifii', {'entities': [[6, 14, 'ISP']]}), ('cari referensi tempat liburan buat besok bersama keluarga', {'entities': [[15, 29, 'PLACE']]}), ('indihome sangat membantu', {'entities': [[0, 8, 'ISP']]}), ('@Telkomsel Klo di mekkah ada ga?', {'entities': [[1, 10, 'ISP'], [18, 24, 'PLACE']]}), ('Aktivitas tadi pagi di hari minggu liat menu masak-masak di youtube, alhasil beres deh masak2 di hari minggu bareng keluarga dan tentunya onlinenya juga puas bareng Indihome dong https://t.co/fOr2ohO4qx', {'entities': [[15, 19, 'TIME'], [28, 34, 'TIME'], [60, 67, 'DIGITAL SERVICE'], [102, 108, 'TIME'], [165, 173, 'ISP']]}), ('Weekend nya sambil nonton MSC MLBB  tetap seru karna pakai indihome  #AktivitasTanpaBatas #InternetnyaIndonesia #SilaturahmiTanpaBatas #indihome #aktifkreatif https://t.co/zHfD3pjqjK', {'entities': [[59, 67, 'ISP'], [136, 144, 'ISP']]}), ('Selamat sore ', {'entities': [[8, 12, 'TIME']]}), ('Youtube an sambel tik_tok dgn menggunakan jaringan indihome Tanpa hambatan sama sekali ', {'entities': [[0, 7, 'DIGITAL SERVICE'], [18, 25, 'DIGITAL SERVICE'], [51, 59, 'ISP'], [60, 65, 'NEGATION'], [66, 74, 'COMPLAIN']]}), ('Thanks indihome Yg selalu ada buat keluarga https://t.co/BzAO6TjyNy', {'entities': [[7, 15, 'ISP']]}), ('@IndiHomeCare @KafaaCahayaAsia @IndiHome Aku cinta indihome', {'entities': [[45, 50, 'COMPLIMENT'], [51, 59, 'ISP']]}), ('Semudah itu dapat informasi kalo googling nya pake koneksi indihome... Nyari info tentang panel surya.. soalnya tetangga ada yang pake... https://t.co/Qbc2H0vKnX', {'entities': [[0, 11, 'COMPLIMENT'], [33, 41, 'DIGITAL SERVICE'], [59, 67, 'ISP']]}), ('Streaming lancarr', {'entities': [[0, 17, 'COMPLIMENT']]}), ('#IndiHome https://t.co/6oTEAvQehL', {'entities': [[1, 9, 'ISP']]}), ('sore2 indikidschannel lewat https://t.co/T3uY9uAugz koneksi tetap lancar karena koneksi pake indihome', {'entities': [[0, 5, 'TIME'], [6, 21, 'DIGITAL SERVICE'], [52, 72, 'COMPLIMENT'], [93, 101, 'ISP']]}), ('Temkomsel.listrik kalau cermat gak di korupsi itung2 nganya  Banyak yg memakai listrik dan pulsa berapa duit yg ngalir per Bulan ...untung. bukan rugi..di gerogoti bilatung2 berdasi BUMN', {'entities': [[0, 17, 'ISP'], [155, 163, 'COMPLAIN'], [164, 173, 'SWEAR']]}), ('Tidak perlu khawatir bagi pelanggan IndiHome, walaupun di hari libur tekhnisi IndiHome selalu siap melayani pelanggan ...Mantap IndiHomeüëç https://t.co/9YYcmuGAgZ', {'entities': [[36, 44, 'ISP'], [58, 68, 'TIME'], [78, 86, 'ISP'], [121, 127, 'COMPLIMENT'], [128, 138, 'ISP']]}), ('lihat balap motor trail ternyata seru , spotv dan indihome mmg the best', {'entities': [[40, 45, 'DIGITAL SERVICE'], [50, 58, 'ISP']]}), ('@Telkomsel Min saya pakai Telkomsel dah bertahun tahun..  085263626917', {'entities': [[1, 10, 'ISP'], [26, 35, 'ISP'], [40, 56, 'TIME'], [58, 70, 'NUMBER']]}), ('Di pinggiran kota pekan baru sinyal makin susah .. tlong min respon .. setelah kantor Telkomsel Pekanbaru di jalan Sudirman kebakaran sampai skrg sinyal internet Telkomsel di daerah saya makin bikin emosi .', {'entities': [[18, 28, 'PLACE'], [29, 47, 'COMPLAIN'], [79, 105, 'PLACE'], [109, 123, 'PLACE'], [162, 171, 'ISP']]}), ('@Telkomsel Di daerah saya banyak yg beralih ke XL smaa. Indosat . Mohon pelayanan nya min', {'entities': [[1, 10, 'ISP'], [14, 25, 'PLACE'], [36, 43, 'COMPLAIN'], [47, 49, 'ISP'], [56, 63, 'ISP']]}), ('Nonton tutorial video di tiktok memang sangat menyenangkan apalagi menggunakan jaringan indihome üòä', {'entities': [[25, 31, 'DIGITAL SERVICE'], [46, 58, 'COMPLIMENT'], [88, 96, 'ISP']]}), ('@Telkomsel @9999999zzz @msaid_didu Min telkomsel kenapa wa kalian gak bales sih HP ku ilang di airport, pengen blokir no halo ku. Please di bales', {'entities': [[1, 10, 'ISP'], [24, 34, 'PERSON'], [39, 48, 'ISP'], [95, 102, 'PLACE']]}), ('@9999999zzz @Telkomsel @msaid_didu Wa @Telkomsel juga gak bales. Emang payah bgt', {'entities': [[13, 22, 'ISP'], [39, 48, 'ISP'], [71, 76, 'COMPLAIN']]}), ('@Telkomsel Min baca wa resmi kalian deh..', {'entities': [[1, 10, 'ISP']]}), ('Hari Minggu enaknya ngapainya??? Bingung...ah..yok dirumah sambil online jaringan indihome https://t.co/qVb2dnH36k', {'entities': [[5, 11, 'TIME'], [82, 90, 'ISP']]}), ('karaoke dulu ah pake IndiHome udah lama banget nih ga karokean, sekarang lagi suka banget nyanyiin lagunya Yura Tutur Batin, liriknya keren bangettüé∂', {'entities': [[21, 29, 'ISP'], [107, 111, 'PERSON'], [134, 139, 'COMPLIMENT']]}), ('Hari Minggu enaknya ngapainya??? Bingung...ah..yok dirumah sambil online jaringan indihome https://t.co/9SDot6Q9b5', {'entities': [[5, 11, 'TIME'], [82, 90, 'ISP']]}), ('karaoke dulu ah pake IndiHome udah lama banget nih ga karokean, sekarang lagi suka banget nyanyiin lagunya Yura Tutur Batin, liriknya keren bangettüé∂', {'entities': [[21, 29, 'ISP'], [78, 89, 'COMPLIMENT'], [107, 111, 'PERSON'], [134, 149, 'COMPLIMENT']]}), ('@Telkomsel Ini wa resmi telkomsel kan, tolong di bales https://t.co/OqTTWXzpKz', {'entities': [[1, 10, 'ISP'], [24, 33, 'ISP']]}), ('udah nonton belum? keseruannya teknisi magang episode 8 dari IndiHome, yuk langsung aja cek di YouTube Channel IndiHome.', {'entities': [[95, 102, 'DIGITAL SERVICE'], [111, 119, 'ISP']]}), ('Keseruan nonton si dustin dan terentan muslim di channel YouTube indihome', {'entities': [[19, 25, 'PERSON'], [30, 45, 'PERSON'], [57, 64, 'DIGITAL SERVICE'], [65, 73, 'ISP']]}), ('Channel The Meg Tv Indihome tegang dan seru di tonton ni film gambar dan suaranya juga ga bikin pusing .... https://t.co/uPWdceW3cb', {'entities': [[8, 18, 'DIGITAL SERVICE'], [19, 27, 'ISP'], [87, 95, 'NEGATION'], [96, 102, 'COMPLAIN']]}), ('semangkok mie ayam buat temen nonton film di UseeTV go dari IndiHome, di UseeTV kalian bisa cari film dari yang lokal sampe mancanegara ada semua. IndiHome serukan harimu.', {'entities': [[45, 51, 'DIGITAL SERVICE'], [60, 68, 'ISP'], [73, 79, 'DIGITAL SERVICE'], [147, 155, 'ISP']]}), ('Nonton join the series pasti bakal ketawa gaess, bisa juga nonton di YouTube indihome', {'entities': [[69, 76, 'DIGITAL SERVICE'], [77, 85, 'ISP']]}), ('Hai sobat indihome, bagi yg belum nonton mini series indihome Teknisi Magang ep.8. Yuk cuss buruan tonton di youtube channel Indihome. Nyata kocaknya ü§£', {'entities': [[10, 18, 'ISP'], [109, 116, 'DIGITAL SERVICE'], [125, 134, 'ISP'], [135, 152, 'COMPLIMENT']]}), ('Main FF kalau sinyal jelek jdi ngamok, mending pakai indihome main FF gak pake leg2an', {'entities': [[14, 26, 'COMPLAIN'], [31, 37, 'COMPLAIN'], [39, 46, 'NEGATION'], [53, 61, 'ISP'], [70, 78, 'NEGATION'], [79, 85, 'COMPLAIN']]}), ('Kalau udah siang2 begini, saya suka baca Novel dengan tentunya harus jaringan internet cepat dong sehingga bacanya juga lancar,  untung di kantor pakai internet indihome yang sangat cepat jadinya senng deh https://t.co/WEfWBIroLn', {'entities': [[11, 17, 'TIME'], [78, 92, 'COMPLIMENT'], [120, 126, 'COMPLIMENT'], [161, 169, 'ISP'], [175, 187, 'COMPLIMENT'], [196, 201, 'COMPLIMENT']]}), ('Hari ini adalah #PSISDay , yg ga sempet #AwayDay ke Stadion Manahan Solo ngga perlu khawatir, kalian msh bs ntn di Vidio melalui IndiHome TV kalian.', {'entities': [[0, 8, 'TIME'], [52, 67, 'PLACE'], [68, 72, 'CITY'], [73, 77, 'NEGATION'], [84, 92, 'COMPLAIN'], [115, 120, 'DIGITAL SERVICE'], [129, 140, 'DIGITAL SERVICE']]}), ('bener bener kocak nih si tretan dan dustin, yuk langsung aja di cek aja keseruan mereka berdua di YouTube Channel IndiHome, terknisi magang episode 8.', {'entities': [[12, 17, 'COMPLIMENT'], [25, 31, 'PERSON'], [36, 42, 'PERSON'], [98, 105, 'DIGITAL SERVICE'], [114, 122, 'ISP']]}), ('Selamat siang ', {'entities': [[8, 13, 'TIME']]}), ('Sambil menikmati youtube dan tik_tok ', {'entities': [[7, 16, 'COMPLIMENT'], [17, 24, 'DIGITAL SERVICE'], [29, 36, 'DIGITAL SERVICE']]}), ('Dengan jaringan indihome Yg lancar tanpa ada hambatan sama sekali ', {'entities': [[16, 24, 'ISP'], [28, 34, 'COMPLIMENT'], [35, 40, 'NEGATION'], [45, 53, 'COMPLAIN']]}), ('Terimakasih indihome yg selalu menemani https://t.co/nC8w0DyIK2', {'entities': [[0, 11, 'COMPLIMENT'], [12, 20, 'ISP'], [24, 39, 'COMPLIMENT']]}), ('teknisi magang dari IndiHome ada lagi nih, yuk langsung aja ke channel YouTube IndiHome, saksikan keseruan si dustin dan tretan.', {'entities': [[20, 28, 'ISP'], [71, 78, 'DIGITAL SERVICE'], [79, 87, 'ISP'], [110, 116, 'PERSON'], [121, 127, 'PERSON']]}), ('Nonton series tentang pemadam kebakaran di useetv indihome filmnya bagus bgt, kesigapan para damkar ini patut di contoh sih. https://t.co/gDTFVHUZ6P', {'entities': [[43, 49, 'DIGITAL SERVICE'], [50, 58, 'ISP'], [67, 76, 'COMPLIMENT'], [104, 119, 'COMPLIMENT']]}), ('Hai! Ada bonus 20RB dan Voucher Alfamart 20RB untukmu yang langsung bisa ditarik, nih! Yuk, download Shopee dulu dengan klik link ini: #Bonu https://t.co/M5VDHZB6sp', {'entities': [[9, 14, 'COMPLIMENT'], [101, 107, 'DIGITAL SERVICE']]}), ('#ShopeePayTHR #ShopeeID #TransferPakaiShopeePay Telkomsel #zonauang·Ö† #jokitugas #zonauang https://t.co/eDTySLFyX2', {'entities': [[48, 57, 'ISP']]}), ('Aksi ini didukung oleh Pemerintah Kelurahan Pulau Raam, PT. Pertamina, Bank Mandiri Cabang Sorong, PT. Buma Perindahindo Indonesia, ', {'entities': [[9, 17, 'COMPLIMENT'], [44, 54, 'PLACE'], [121, 130, 'PLACE']]}), ('PT. Tirta Mambramo, Telkomsel Sorong, ', {'entities': [[20, 29, 'ISP'], [30, 36, 'PLACE']]}), ('@TelkomIndonesia @Telkomsel ', {'entities': [[1, 16, 'ISP'], [18, 27, 'ISP']]}), ('Pas banget di depan rumah lihat teknisi IndiHome lagi benerin tiang IndiHome', {'entities': [[0, 10, 'COMPLIMENT'], [14, 25, 'PLACE'], [32, 39, 'PERSON'], [40, 48, 'ISP']]}), ('Trik panas dan hujan mereka lalui, apresiasi utk IndiHome selalu ngasih yg terbaik untuk para pelanggan setianyaüòç https://t.co/S69PvpiHC0', {'entities': [[49, 57, 'ISP'], [65, 82, 'COMPLIMENT'], [94, 103, 'PERSON']]}), ('Jangan sampai ngelewatin keseruan Dustin dan Muslim di Teknisi Magang episode terbaru! Banyak momen gemes yang bikin geregetan. ü§© Sudah tayang di channel YouTube IndiHome! ü•≥ ', {'entities': [[34, 40, 'PERSON'], [45, 51, 'PERSON'], [100, 105, 'COMPLIMENT'], [111, 127, 'COMPLAIN'], [155, 162, 'DIGITAL SERVICE'], [163, 171, 'ISP']]}), ('#IndiHomeJaktim https://t.co/RPVyEpAVun', {'entities': [[1, 15, 'ISP']]}), ('@maspiyuaja mang telkomsel itu BUMN?', {'entities': [[1, 11, 'PERSON'], [17, 26, 'ISP']]}), ('PENGEN NONTON PRAMBANAN JAZZ TAPI NGGAK ADA DUIT?', {'entities': [[29, 33, 'NEGATION']]}), ('Cukup aktifkan Minipack iKonser Indihome dengan biaya berlangganan', {'entities': [[24, 40, 'DIGITAL SERVICE']]}), ('PENGEN NONTON PRAMBANAN JAZZ TAPI NGGAK ADA DUIT?', {'entities': [[34, 39, 'NEGATION']]}), ('Cukup aktifkan Minipack iKonser Indihome dengan biaya berlangganan', {'entities': [[24, 31, 'DIGITAL SERVICE'], [32, 40, 'ISP']]}), ('Cukup aktifkan Minipack iKonser Indihome dengan biaya berlangganan', {'entities': [[24, 31, 'DIGITAL SERVICE'], [32, 40, 'ISP']]}), ('DATETIME: 2022-06-13T11:20:57.098Z', {'entities': [[10, 34, 'TIME']]}), ('MSISDN: 6281260077851', {'entities': [[8, 21, 'NUMBER']]}), ('CARD: Telkomsel Kartu Halo', {'entities': [[6, 15, 'ISP'], [16, 26, 'DIGITAL SERVICE']]}), ('IMEI: 352721092247837', {'entities': [[6, 21, 'NUMBER']]}), ('IMSI: 510106026001064', {'entities': [[6, 21, 'NUMBER']]}), ('TAC: 5125', {'entities': [[5, 9, 'NUMBER']]}), ('ENB: 24084', {'entities': [[5, 10, 'NUMBER']]}), ('ADDRESS: Sumatera Utara, Deli Serdang, Percut Sei Tuan, Hutan', {'entities': [[9, 23, 'PLACE'], [25, 37, 'CITY'], [39, 54, 'PLACE'], [56, 61, 'PLACE']]}), ('@IndiHomeCare Hai Min. Saya sdh DM ke @IndiHome, belum direspon.', {'entities': [[39, 47, 'ISP']]}), ('yuk JION bareng tretan dan dustin, saksikan keseruan mereka berdua di acara teknisi magang dari IndiHome eksklusif di channel YouTube IndiHome.', {'entities': [[16, 22, 'PERSON'], [27, 33, 'PERSON'], [96, 104, 'ISP'], [126, 133, 'DIGITAL SERVICE'], [134, 142, 'ISP']]}), ('Akhirnya rilis juga nih teknisi magang IndiHome eps 8. ', {'entities': [[24, 31, 'PERSON'], [39, 47, 'ISP']]}), ('Yuk tonton series nya di channel YouTube IndiHome', {'entities': [[33, 40, 'DIGITAL SERVICE'], [41, 49, 'ISP']]}), ('@AnasCcf Samaan ya kita, kalau sdh siang tuh klw ngak nonton baca novel tentunya dong konektivitas @IndiHome biar makin lancar', {'entities': [[100, 108, 'ISP'], [114, 126, 'COMPLIMENT']]}), ('Butut banget jaringan telkomsel dirumah ini üò¥üò¥', {'entities': [[22, 31, 'ISP'], [32, 39, 'PLACE']]}), ('Fery IndiHome Witel Bandung ', {'entities': [[0, 4, 'PERSON'], [5, 13, 'ISP'], [14, 27, 'PLACE']]}), ('Layanan Pasang Baru Online  Internet  &amp;  UseeTv  IndiHome  Area Bandung Jawa Barat Hubungin : 082240358056 https://t.co/Xtm9m9wVx2', {'entities': [[53, 61, 'ISP'], [68, 75, 'CITY'], [76, 86, 'PLACE'], [98, 110, 'NUMBER']]}), ('Pilihan Promo  Telpon &amp;  IndiHome  Bandung  Jawa Barat Hubungin : 082240358056 https://t.co/D4pMP5harb', {'entities': [[29, 37, 'ISP'], [39, 46, 'CITY'], [48, 58, 'PLACE'], [70, 82, 'NUMBER']]}), ('Layanan  Pasang Baru Online Internet &amp;  UseeTv  IndiHome  Area Bandung Jawa   Barat  Hubungin : 082240358056 https://t.co/FMiiGETW17', {'entities': [[44, 50, 'DIGITAL SERVICE'], [52, 60, 'ISP'], [67, 74, 'CITY'], [75, 87, 'PLACE'], [100, 112, 'NUMBER']]}), ('#telkomjabar', {'entities': [[1, 12, 'ISP']]}), ('#indihome', {'entities': [[1, 9, 'ISP']]}), ('@oppungdoliii @Telkomsel bangke lah. ü§£ü§£ü§£', {'entities': [[15, 24, 'ISP'], [25, 31, 'SWEAR']]}), ('Kalau bosan streaming film, tinggal main game aja di Steam. Jgn lupa koneksi dgn HSI GAMERS nya IndiHome. Main game bisa menang terus karena koneksinya anti lelet. Eeh tapi tergantung skill main kalian jg sih hehehe üòÄüòÉüòÑ https://t.co/w73CttQdIc', {'entities': [[6, 11, 'COMPLAIN'], [53, 59, 'DIGITAL SERVICE'], [81, 91, 'DIGITAL SERVICE'], [96, 105, 'ISP'], [152, 156, 'NEGATION'], [157, 163, 'COMPLAIN'], [168, 172, 'NEGATION']]}), ('Saya mau berhenti berlangganan krn sudah pindah rumah, gimana caranya? @IndiHome', {'entities': [[9, 30, 'COMPLAIN']]})]

def train_spacy(data,iterations):
    TRAIN_DATA = data
    nlp = spacy.blank('en')  # create blank Language class
    # create the built-in pipeline components and add them to the pipeline
    # nlp.create_pipe works for built-ins that are registered with spaCy
    if 'ner' not in nlp.pipe_names:
        ner = nlp.create_pipe('ner')
        nlp.add_pipe(ner, last=True)
       

    # add labels
    for _, annotations in TRAIN_DATA:
         for ent in annotations.get('entities'):
            ner.add_label(ent[2])

    # get names of other pipes to disable them during training
    other_pipes = [pipe for pipe in nlp.pipe_names if pipe != 'ner']
    with nlp.disable_pipes(*other_pipes):  # only train NER
        optimizer = nlp.begin_training()
        for itn in range(iterations):
            print("Statring iteration " + str(itn))
            random.shuffle(TRAIN_DATA)
            losses = {}
            for text, annotations in TRAIN_DATA:
                nlp.update(
                    [text],  # batch of texts
                    [annotations],  # batch of annotations
                    drop=0.2,  # dropout - make it harder to memorise data
                    sgd=optimizer,  # callable to update weights
                    losses=losses)
            print(losses)
    return nlp


prdnlp = train_spacy(TRAIN_DATA, 20)

# Save our trained Model
modelfile = input("Enter your Model Name: ")
prdnlp.to_disk(modelfile)

#Test your text
test_text = input("Enter your testing text: ")
doc = prdnlp(test_text)
for ent in doc.ents:
    print(ent.text, ent.start_char, ent.end_char, ent.label_)